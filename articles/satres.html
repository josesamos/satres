<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="satres">
<title>Grouping satellite bands by spectral and spatial resolution • satres</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Grouping satellite bands by spectral and spatial resolution">
<meta property="og:description" content="satres">
<meta property="og:image" content="https://josesamos.github.io/satres/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">satres</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/satres.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/josesamos/satres/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Grouping satellite bands by spectral and spatial resolution</h1>
                        <h4 data-toc-skip class="author">Jose Samos (<a href="mailto:jsamos@ugr.es" class="email">jsamos@ugr.es</a>)</h4>
            
            <h4 data-toc-skip class="date">2023-09-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/josesamos/satres/blob/HEAD/vignettes/satres.Rmd" class="external-link"><code>vignettes/satres.Rmd</code></a></small>
      <div class="d-none name"><code>satres.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We frequently download files with satellite bands from the <a href="https://dataspace.copernicus.eu/" class="external-link"><em>ESA</em></a> and <a href="https://glovis.usgs.gov/" class="external-link"><em>USGS</em></a> websites to perform
data analysis, transform them or store them in DBMS. They are downloaded
as files in ZIP or TAR format. In some cases, it is necessary to
download several files that cover the study area, so the first operation
to perform is to merge the bands. To access the bands we have to
explicitly indicate the name and location of their files.</p>
<p>The goal of <code>satres</code> (<em>sat</em>ellite spectral and
spatial <em>res</em>olution) is to facilitate these operations by at
least partially automating them. It includes a function that makes it
easier to decompress files, useful when downloading many files. To treat
them together, it is enough to indicate the folder that contains the
decompressed files: Satellite bands are automatically obtained by name
(spectral) and spatial resolution; if we have several files to cover a
geographical area, the corresponding bands are automatically merged. The
result can be stored on disk and can also be obtained as objects of
class <code>SpatRaster</code>, from package <a href="https://CRAN.R-project.org/package=terra" class="external-link"><code>terra</code></a>.</p>
<p>The following is an illustrative example of how the package works, to
show usage of features it offers. Finally, the document ends with
conclusions.</p>
</div>
<div class="section level2">
<h2 id="an-illustrative-example">An illustrative example<a class="anchor" aria-label="anchor" href="#an-illustrative-example"></a>
</h2>
<p>In this section an illustrative example is developed to show how the
package works.</p>
<div class="section level3">
<h3 id="getting-the-data">Getting the data<a class="anchor" aria-label="anchor" href="#getting-the-data"></a>
</h3>
<p>We want to do an analysis based on raster data obtained by satellite
of the area of the municipality of Lanjarón in Granada (Spain). To cover
this area, we have downloaded two satellite band files from the <a href="https://dataspace.copernicus.eu/" class="external-link"><em>ESA</em></a> website.</p>
<ul>
<li>
<code>S2A_MSIL2A_20230905T105621_N0509_R094_T30SVF_20230905T170700.zip</code>:
0.91 GB</li>
<li>
<code>S2A_MSIL2A_20230905T105621_N0509_R094_T30SVG_20230905T170700.zip</code>:
1.14 GB</li>
</ul>
<p>In this case, the area is very small and requires only two files, we
can decompress them one by one with any unzip tool. We can also use the
<code><a href="../reference/sat_untarzip.html">sat_untarzip()</a></code> function of the package: it decompresses all
the indicated list of files or all the files included in the given
folder.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sat_untarzip.html">sat_untarzip</a></span><span class="op">(</span><span class="st">"download/esa"</span>, out_dir <span class="op">=</span> <span class="st">"esa"</span><span class="op">)</span></span></code></pre></div>
<p>We have unzipped them directly into a folder (<code>esa</code>
folder), creating two subfolders.</p>
<p>In order to reduce their size so they can be included in the package,
we have additionally selected and transformed the original raster files,
grouping them using the <code><a href="https://rdrr.io/pkg/terra/man/aggregate.html" class="external-link">terra::aggregate()</a></code> function with a
factor of 100. The result is the following folders:</p>
<ul>
<li>
<code>esa/f</code>: 751 KB</li>
<li>
<code>esa/g</code>: 842 KB</li>
</ul>
<p>These folders are included in the package. They directly contain all
raster files transformed according to the previous description. We can
access them as shown below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"esa/f"</span>, package <span class="op">=</span> <span class="st">"satres"</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"esa/g"</span>, package <span class="op">=</span> <span class="st">"satres"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="merging-and-classifying-data">Merging and classifying data<a class="anchor" aria-label="anchor" href="#merging-and-classifying-data"></a>
</h3>
<p>To merge the satellite bands corresponding to the same geographical
area (tiles) and classify them according to their spatial resolution, we
only have to create an object of the <code>satres</code> class. We pass
as a parameter the folder where the files are located. We can also
indicate a work folder as a parameter, where the virtual rasters will be
created; if none is indicated, a temporary folder will be used.</p>
<p>By default, only the satellite bands (<em>B01</em> to <em>B12</em>)
are considered. By setting the <code>only_bands</code> parameter to
<code>FALSE</code>, we can indicate that all raster files included in
the folders that cover the area of interest are also treated, as shown
in the code below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sr_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/satres.html">satres</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"esa"</span>, out_dir <span class="op">=</span> <span class="st">"esa/out"</span>, only_bands <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>For this case we only need the bands (<em>B01</em> to <em>B12</em>),
which we then obtain from the data stored in this package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">esa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"esa"</span>, package <span class="op">=</span> <span class="st">"satres"</span><span class="op">)</span></span>
<span><span class="va">sr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/satres.html">satres</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">esa</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-the-results">Using the results<a class="anchor" aria-label="anchor" href="#using-the-results"></a>
</h3>
<p>Next we consult the spatial resolution of the result (remember that
we have changed the resolution, adding it by a factor of 100).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_spatial_resolution.html">get_spatial_resolution</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "r1000m" "r2000m" "r6000m"</span></span></code></pre></div>
<p>We obtain an object of class <code>SpatRaster</code> from the
<code>terra</code> package with all the bands of the indicated spatial
resolution.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r1000m</span> <span class="op">&lt;-</span> <span class="va">sr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_SpatRaster.html">as_SpatRaster</a></span><span class="op">(</span><span class="st">"r1000m"</span><span class="op">)</span></span></code></pre></div>
<p>To show the available bands, we represent them graphically below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r1000m</span><span class="op">)</span></span></code></pre></div>
<p><img src="satres_files/figure-html/bands-1.png" width="700"></p>
<p>The bands are directly accessible by name (<em>B02</em>,
<em>B03</em>, <em>B04</em> and <em>B08</em> in the figure), within each
object obtained in the result.</p>
<p>In the same way we can obtain the objects for the other levels of
spatial resolution. In this case we are only going to show the names of
the bands.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r2000m</span> <span class="op">&lt;-</span> <span class="va">sr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_SpatRaster.html">as_SpatRaster</a></span><span class="op">(</span><span class="st">"r2000m"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r2000m</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "B01" "B02" "B03" "B04" "B05" "B06" "B07" "B11" "B12" "B8A"</span></span>
<span></span>
<span><span class="va">r6000m</span> <span class="op">&lt;-</span> <span class="va">sr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_SpatRaster.html">as_SpatRaster</a></span><span class="op">(</span><span class="st">"r6000m"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r6000m</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "B01" "B02" "B03" "B04" "B05" "B06" "B07" "B09" "B11" "B12" "B8A"</span></span></code></pre></div>
<p>We can save the results to disk using the functions of the
<code>terra</code> package. But we can also save them directly using the
<code><a href="../reference/save_by_resolution.html">save_by_resolution()</a></code> function, which stores them with file
names obtained based on the spatial resolution. In this example, the
<code>only_show_files</code> parameter controls the execution of the
function so that it only displays the file names.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/save_by_resolution.html">save_by_resolution</a></span><span class="op">(</span>out_dir <span class="op">=</span> <span class="st">"esa/out"</span>, only_show_files <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "esa/out/r1000m.tif" "esa/out/r2000m.tif" "esa/out/r6000m.tif"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>The functions of the <code>satres</code> package make it easier to
work with satellite rasters.</p>
<p>Instead of accessing files individually by name, it merges files that
form tiles from the same area and groups them according to their spatial
resolution into one object.</p>
<p>We can obtain objects of class <code>SpatRaster</code> and work with
the <code>terra</code> package or we can store the result on disk to
process it by other means.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jose Samos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
